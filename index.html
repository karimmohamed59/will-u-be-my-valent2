<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mai â€” Will you be my Valentine?</title>
  <style>
    :root{
      --bg: #fff0f6;
      --accent: #ff4d6d;
      --muted: #7a536b;
      --paper: #fff8f5;
      --ink: #3b1f2b;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: radial-gradient(circle at 10% 10%, #fff0f6 0%, #fff 30%), linear-gradient(180deg,#ffeef2 0%, #fff0f6 100%);
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      position:relative;
      width:min(920px, 95vw);
      height:min(680px, 95vh);
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,240,246,0.9));
      border-radius:18px;
      box-shadow: 0 12px 40px rgba(120,40,70,0.12);
      padding:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.6);
      display:flex;
      flex-direction:column;
    }

    header {
      text-align:center;
      margin-bottom:6px;
    }

    h1{
      margin:6px 0 0 0;
      font-size:clamp(22px, 3vw, 36px);
      letter-spacing:0.4px;
      color:#5a2336;
    }
    p.lead{
      margin:8px 0 18px 0;
      color:var(--muted);
      font-size:clamp(13px, 1.2vw, 16px);
    }

    .stage {
      position:relative;
      flex: 1 1 auto;
      border-radius:12px;
      background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.65), transparent 10%),
                  linear-gradient(180deg, rgba(255,240,246,0.6), rgba(255, 245, 248, 0.2));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      user-select:none;
      padding:18px;
    }

    .btn {
      appearance:none;
      border:0;
      padding:12px 20px;
      font-size:17px;
      border-radius:999px;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(120,40,70,0.12);
      transition: left 700ms cubic-bezier(.2,.9,.2,1), top 700ms cubic-bezier(.2,.9,.2,1), transform 350ms;
      position:absolute;
      transform: translate(-50%,-50%);
      background: #fff;
    }

    .btn:active { transform: translate(-50%,-50%) translateY(2px); }

    .yes {
      background: linear-gradient(90deg,#ff6b81,#ff3b5c);
      color:white;
    }
    .no {
      background: white;
      color:var(--accent);
      border:2px solid rgba(255,77,109,0.12);
    }

    /* adjusted button positions (down a bit) */
    #yesBtn { left:calc(50% + 80px); top:72%; }
    #noBtn  { left:calc(50% - 80px); top:72%; }

    /* centered GIF â€” smaller and higher so it doesn't overlap header or buttons */
    .center-gif{
      position:absolute;
      left:50%;
      top:30%;
      transform:translate(-50%,-50%);
      width:160px;
      height:160px;
      object-fit:cover;
      border-radius:10px;
      box-shadow:0 18px 40px rgba(120,40,70,0.10);
      cursor:pointer;
      z-index:20;
      pointer-events: auto;
      background: transparent;
      display:block;
    }

    /* photo gallery for no-clicks (bottom-left) */
    .no-gallery {
      position:absolute;
      left:12px;
      bottom:12px;
      display:flex;
      gap:8px;
      align-items:end;
      max-width:40%;
      max-height:40%;
      overflow:hidden;
      z-index:5;
    }
    .no-gallery img {
      width:84px;
      height:64px;
      object-fit:cover;
      border-radius:10px;
      box-shadow: 0 6px 14px rgba(80,30,60,0.12);
      opacity:0;
      transform: translateY(12px) scale(.98);
      transition: opacity 450ms, transform 450ms;
      cursor: pointer;
      background: transparent;
    }
    .no-gallery img.show { opacity:1; transform: translateY(0) scale(1); }

    /* overlay for yes result (shows 3 photos) */
    .yes-overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.0), rgba(255,240,246,0.7));
      pointer-events:none;
      opacity:0;
      transition: opacity 350ms;
      z-index:6;
    }
    .yes-overlay.show { opacity:1; pointer-events:auto; }
    .yes-overlay img {
      width:220px;
      height:140px;
      object-fit:cover;
      border-radius:12px;
      box-shadow: 0 12px 40px rgba(120,40,70,0.15);
      transform:scale(.98);
      transition: transform 450ms, box-shadow 300ms;
      cursor: pointer;
      background: transparent;
    }
    .yes-overlay.show img { transform:scale(1); }
    .yes-overlay img:hover { transform: scale(1.04); box-shadow: 0 18px 50px rgba(120,40,70,0.2); }

    /* Love letter button â€” absolute inside stage; shown after Yes, placed under yes photos and above buttons */
    .love-letter-btn {
      position:absolute;
      left:50%;
      transform:translate(-50%,0);
      z-index:12;
      padding:18px 28px;
      border-radius:18px;
      border:0;
      background: linear-gradient(90deg,#ff9fb8,#ff5f90);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 18px 44px rgba(255,90,140,0.18);
      display:none; /* shown after yes */
      font-size:20px;
      white-space:nowrap;
    }
    .love-letter-btn:focus { outline: 3px solid rgba(255,110,150,0.18); }

    /* popup (center big photo/GIF) */
    .popup {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(20,10,15,0.45);
      z-index:9999;
      opacity:0;
      pointer-events:none;
      transition: opacity 250ms ease;
      backdrop-filter: blur(6px) saturate(120%);
    }
    .popup.show { opacity:1; pointer-events:auto; }
    .popup-card {
      max-width:min(88vw,980px);
      max-height:86vh;
      border-radius:14px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      transform: scale(.8);
      transition: transform 260ms cubic-bezier(.2,.9,.2,1);
      box-shadow: 0 30px 80px rgba(20,10,20,0.45);
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,250,253,0.95));
    }
    .popup.show .popup-card { transform: scale(1); }
    .popup-card img { width:100%; height:100%; object-fit:contain; display:block; background:#000; }
    .popup-close {
      position:absolute;
      top:18px;
      right:18px;
      background:rgba(255,255,255,0.9);
      border-radius:999px;
      border:0;
      padding:6px 10px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 8px 18px rgba(120,40,70,0.08);
    }

    /* letter modal */
    .letter-modal {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(10,6,10,0.45);
      z-index:10010;
      opacity:0;
      pointer-events:none;
      transition: opacity 240ms ease;
      backdrop-filter: blur(4px) saturate(120%);
    }
    .letter-modal.show { opacity:1; pointer-events:auto; }
    .letter-card {
      width:min(760px,86vw);
      max-height:86vh;
      background: linear-gradient(180deg, var(--paper), #fff);
      border-radius:14px;
      padding:26px;
      box-shadow: 0 30px 90px rgba(30,10,20,0.35);
      transform: translateY(8px) scale(.96);
      transition: transform 260ms cubic-bezier(.2,.9,.2,1);
      overflow:auto;
      position:relative;
      font-family: Georgia, "Times New Roman", Times, serif;
      color:var(--ink);
    }
    .letter-modal.show .letter-card { transform: translateY(0) scale(1); }
    .letter-inner {
      background: linear-gradient(180deg,#fff8f4,#fffaf8);
      border-radius:8px;
      padding:28px;
      border: 1px solid rgba(220,160,170,0.08);
      box-shadow: inset 0 6px 18px rgba(240,200,210,0.06);
    }
    .letter-title { margin:0 0 12px 0; font-size:22px; font-weight:700; color:#8b2b48; }
    .letter-text { margin:0; font-size:18px; line-height:1.6; color:#4a2a36; white-space:pre-wrap; }
    .letter-close { position:absolute; top:12px; right:12px; background:transparent; border:0; font-size:20px; cursor:pointer; padding:6px 8px; color:#6a3b47; }

    /* hearts */
    .heart { position:absolute; width:26px; height:26px; background: linear-gradient(180deg,#ff6b81,#ff3b5c); transform: rotate(-45deg); left:50%; top:50%; border-radius:4px 4px 0 0; pointer-events:none; opacity:0.95; animation: floatUp 2600ms linear forwards; filter: drop-shadow(0 6px 14px rgba(120,40,70,0.12)); }
    .heart::before, .heart::after { content:""; position:absolute; width:26px; height:26px; background: linear-gradient(180deg,#ff6b81,#ff3b5c); border-radius:50%; top:-13px; left:0; }
    .heart::after { left:13px; top:0; }
    @keyframes floatUp { 0% { transform: translateY(0) scale(.8) rotate(-45deg); opacity:1; } 30% { transform: translateY(-60px) scale(1.05) rotate(-35deg); } 70% { transform: translateY(-180px) scale(.95) rotate(-15deg); opacity:0.85; } 100% { transform: translateY(-320px) scale(.6) rotate(-5deg); opacity:0; } }

    /* small footer */
    .footer { display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px; color:var(--muted); font-size:13px; }

    /* responsive tweaks */
    @media (max-width:700px){
      .center-gif{ width:120px; height:120px; top:26%; }
      .yes-overlay img{ width:140px; height:96px; }
      .no-gallery img{ width:60px; height:50px; }
      #yesBtn,#noBtn { top:80%; padding:10px 14px; font-size:15px; }
      .love-letter-btn { font-size:18px; padding:14px 22px; border-radius:16px; }
    }
  </style>
</head>
<body>
  <div class="card" role="main" aria-label="Valentine card for Mai">
    <header>
      <h1>Mai â€” will you be my Valentine?</h1>
      <p class="lead">Click your answer. I promise it'll be fun either way ðŸ’Œ</p>
    </header>

    <div class="stage" id="stage">
      <div class="controls" aria-hidden="false">
        <button id="noBtn" class="btn no" aria-label="No button">No</button>
        <button id="yesBtn" class="btn yes" aria-label="Yes button">Yes</button>
      </div>

      <!-- Center GIF (replace assets/center.gif with your file or a URL) -->
      <img id="centerGif" class="center-gif" src="assets/center.gif" alt="Surprise GIF â€” click to open" role="button" tabindex="0" aria-label="Open GIF" />

      <div class="no-gallery" id="noGallery" aria-hidden="true"></div>

      <div class="yes-overlay" id="yesOverlay" aria-hidden="true">
        <img id="yesImg1" alt="surprise photo 1" />
        <img id="yesImg2" alt="surprise photo 2" />
        <img id="yesImg3" alt="surprise photo 3" />
      </div>

      <!-- love letter button (absolute inside stage) -->
      <button id="loveLetterBtn" class="love-letter-btn" aria-hidden="true" aria-label="Open love letter">ðŸ’Œ Open Love Letter</button>
    </div>

    <div class="footer">Tip: if music doesn't play automatically, try clicking the page again â€” browsers require interaction for audio.</div>
  </div>

  <!-- Popup element (hidden until used) -->
  <div id="popup" class="popup" aria-hidden="true">
    <div class="popup-card" role="dialog" aria-modal="true" aria-label="Photo/GIF popup">
      <img id="popupImg" alt="Large view" />
    </div>
    <button id="popupClose" class="popup-close" aria-label="Close">âœ•</button>
  </div>

  <!-- Letter modal -->
  <div id="letterModal" class="letter-modal" aria-hidden="true">
    <div class="letter-card" role="dialog" aria-modal="true" aria-label="Love letter">
      <button id="letterClose" class="letter-close" aria-label="Close letter">âœ•</button>
      <div class="letter-inner" id="letterInner">
        <h3 class="letter-title">To Mai</h3>
        <p class="letter-text" id="letterText">
i love u mai
from all my heart
u are the best thing that happened to me
        </p>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const stage = document.getElementById('stage');
    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const noGallery = document.getElementById('noGallery');
    const yesOverlay = document.getElementById('yesOverlay');
    const yesImg1 = document.getElementById('yesImg1');
    const yesImg2 = document.getElementById('yesImg2');
    const yesImg3 = document.getElementById('yesImg3');

    const centerGif = document.getElementById('centerGif');

    const loveLetterBtn = document.getElementById('loveLetterBtn');
    const letterModal = document.getElementById('letterModal');
    const letterClose = document.getElementById('letterClose');
    const letterText = document.getElementById('letterText');

    const popup = document.getElementById('popup');
    const popupImg = document.getElementById('popupImg');
    const popupClose = document.getElementById('popupClose');

    // ====== Replace with your files (local assets/ or full URLs) ======
    const noImages = [
      "assets/no1.jpg",
      "assets/no2.jpg",
      "assets/no3.jpg",
      "assets/no4.jpg"
    ];
    const yesImages = [
      "assets/yes1.jpg",
      "assets/yes2.jpg",
      "assets/yes3.jpg"
    ];
    const musicUrl = "assets/music.mp3";
    // center GIF path is in the img src attribute above (assets/center.gif)
    // ===================================================================

    const pleadingPhrases = [
      "Please, Mai... â¤ï¸",
      "Don't break my heart ðŸ˜¢",
      "Pretty please? ðŸ¥º",
      "Think again, Mai ðŸ’”âž¡ï¸ðŸ’–",
      "I promise I'll be extra nice ðŸ˜‡",
      "Please say yes, Mai ðŸŒ¹",
      "Not yet? I can try harder ðŸ˜‰",
      "Come on, Mai â€” my heart! ðŸ’“",
      "I brought flowers... virtually ðŸŒ·",
      "I'll do anything! (within reason) ðŸ˜…"
    ];

    let noClicks = 0;
    let yesScale = 1;

    function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }

    // Generic popup for images/GIFs
    function showPopup(src, autoCloseMs = 0) {
      if (!src) return;
      popupImg.src = src + (src.includes('?') ? '&' : '?') + 'rand=' + Date.now();
      popup.classList.add('show');
      popup.setAttribute('aria-hidden', 'false');

      if (autoCloseMs && autoCloseMs > 0) {
        setTimeout(hidePopup, autoCloseMs);
      }
    }
    function hidePopup() {
      popup.classList.remove('show');
      popup.setAttribute('aria-hidden', 'true');
      setTimeout(() => { popupImg.src = ''; }, 300);
    }
    popupClose.addEventListener('click', hidePopup);
    popup.addEventListener('click', (e) => { if (e.target === popup) hidePopup(); });

    // Letter modal controls
    function showLetter() {
      letterModal.classList.add('show');
      letterModal.setAttribute('aria-hidden', 'false');
      letterText.style.opacity = '0';
      setTimeout(()=> { letterText.style.transition = 'opacity 360ms ease'; letterText.style.opacity = '1'; }, 40);
    }
    function hideLetter() {
      letterModal.classList.remove('show');
      letterModal.setAttribute('aria-hidden', 'true');
    }
    letterClose.addEventListener('click', hideLetter);
    letterModal.addEventListener('click', (e) => { if (e.target === letterModal) hideLetter(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') { hidePopup(); hideLetter(); } });

    // center GIF interaction
    centerGif.addEventListener('click', () => showPopup(centerGif.src, 0));
    centerGif.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showPopup(centerGif.src, 0); } });

    // add thumbnail to no-gallery
    function addNoGalleryPhoto(popupNow = false){
      const idx = (noClicks - 1) % noImages.length;
      const srcBase = noImages[idx];
      const src = srcBase + (srcBase.includes('?') ? '&' : '?') + "rand=" + Date.now();
      const img = document.createElement('img');
      img.src = src;
      img.alt = "cute photo";
      img.addEventListener('click', () => showPopup(src, 0));
      noGallery.appendChild(img);

      img.onload = () => { setTimeout(()=> img.classList.add('show'), 40); };
      setTimeout(()=> img.classList.add('show'), 200);

      while (noGallery.children.length > 6) noGallery.removeChild(noGallery.firstChild);

      if (popupNow) setTimeout(() => showPopup(src, 1400), 220);
    }

    // Yes button behavior:
    yesBtn.addEventListener('click', async (e) => {
      // 1) hide center GIF
      centerGif.style.display = 'none';

      // 2) show three photos
      yesImg1.src = yesImages[0] + (yesImages[0].includes('?') ? '&' : '?') + "rand=" + Date.now();
      yesImg2.src = yesImages[1] + (yesImages[1].includes('?') ? '&' : '?') + "rand=" + Date.now();
      yesImg3.src = yesImages[2] + (yesImages[2].includes('?') ? '&' : '?') + "rand=" + Date.now();

      yesOverlay.classList.add('show');
      yesImg1.onclick = () => showPopup(yesImg1.src, 0);
      yesImg2.onclick = () => showPopup(yesImg2.src, 0);
      yesImg3.onclick = () => showPopup(yesImg3.src, 0);

      // 3) play music
      try {
        const audio = new Audio(musicUrl);
        audio.volume = 0.85;
        await audio.play();
      } catch (err) {
        console.warn("Audio play failed (browser autoplay policy). Try clicking again.", err);
      }

      // 4) spawn hearts
      spawnHearts(28);

      // 5) compute and show love letter button positioned under yes photos and above buttons
      setTimeout(positionAndShowLoveButton, 520);

      // temporarily disable both buttons to avoid repeats
      disableControlsTemporary();
    });

    // No button behavior
    noBtn.addEventListener('click', (e) => {
      noClicks++;
      const phrase = pleadingPhrases[(noClicks - 1) % pleadingPhrases.length];
      noBtn.textContent = phrase;
      moveButtonRandomlyAvoidingForbidden(noBtn);
      yesScale += 0.06;
      yesBtn.style.transform = `translate(-50%,-50%) scale(${yesScale})`;
      addNoGalleryPhoto(true);
      yesBtn.animate([
        { transform: `translate(-50%,-50%) scale(${yesScale}) rotate(0deg)` },
        { transform: `translate(-50%,-50%) scale(${yesScale + 0.03}) rotate(-5deg)` },
        { transform: `translate(-50%,-50%) scale(${yesScale}) rotate(5deg)` },
        { transform: `translate(-50%,-50%) scale(${yesScale}) rotate(0deg)` }
      ], { duration: 600, easing: 'ease-out' });
    });

    // Move button randomly but avoid forbidden areas (center GIF, yes overlay, header, no-gallery, love button, yes button)
    function moveButtonRandomlyAvoidingForbidden(btn){
      const rect = stage.getBoundingClientRect();
      const btnRect = btn.getBoundingClientRect();

      const padding = 10;
      const halfW = btnRect.width / 2;
      const halfH = btnRect.height / 2;
      const minX = halfW + padding;
      const maxX = rect.width - halfW - padding;
      const minY = halfH + padding;
      const maxY = rect.height - halfH - padding;

      // Build forbidden rectangles in stage-relative coordinates
      const forbidden = [];

      // header/top area (avoid overlapping header text)
      const cardHeader = document.querySelector('header');
      if (cardHeader) {
        const hRect = cardHeader.getBoundingClientRect();
        const stageRect = stage.getBoundingClientRect();
        const relTop = Math.max(0, hRect.top - stageRect.top);
        const relBottom = Math.max(0, hRect.bottom - stageRect.top);
        forbidden.push({ left: 0, top: 0, right: rect.width, bottom: Math.min(rect.height, relBottom + 6) });
      }

      // center GIF area (if visible)
      if (centerGif.offsetParent !== null && centerGif.style.display !== 'none') {
        const g = centerGif.getBoundingClientRect();
        forbidden.push({
          left: Math.max(0, g.left - rect.left - 8),
          top: Math.max(0, g.top - rect.top - 8),
          right: Math.min(rect.width, g.right - rect.left + 8),
          bottom: Math.min(rect.height, g.bottom - rect.top + 8)
        });
      }

      // yes overlay area (if visible)
      if (yesOverlay.classList.contains('show')) {
        const y1 = yesOverlay.getBoundingClientRect();
        forbidden.push({
          left: Math.max(0, y1.left - rect.left - 8),
          top: Math.max(0, y1.top - rect.top - 8),
          right: Math.min(rect.width, y1.right - rect.left + 8),
          bottom: Math.min(rect.height, y1.bottom - rect.top + 8)
        });
      }

      // no-gallery area
      if (noGallery.children.length > 0) {
        const g = noGallery.getBoundingClientRect();
        forbidden.push({
          left: Math.max(0, g.left - rect.left - 6),
          top: Math.max(0, g.top - rect.top - 6),
          right: Math.min(rect.width, g.right - rect.left + 6),
          bottom: Math.min(rect.height, g.bottom - rect.top + 6)
        });
      }

      // love-letter button area (if visible)
      if (loveLetterBtn.style.display !== 'none') {
        const l = loveLetterBtn.getBoundingClientRect();
        forbidden.push({
          left: Math.max(0, l.left - rect.left - 6),
          top: Math.max(0, l.top - rect.top - 6),
          right: Math.min(rect.width, l.right - rect.left + 6),
          bottom: Math.min(rect.height, l.bottom - rect.top + 6)
        });
      }

      // yes button should not overlap either
      const yRect = yesBtn.getBoundingClientRect();
      forbidden.push({
        left: Math.max(0, yRect.left - rect.left - 6),
        top: Math.max(0, yRect.top - rect.top - 6),
        right: Math.min(rect.width, yRect.right - rect.left + 6),
        bottom: Math.min(rect.height, yRect.bottom - rect.top + 6)
      });

      // Try to find a safe spot
      let attempts = 0;
      let chosenX, chosenY;
      while (attempts < 40) {
        const candidateX = randInt(minX, Math.max(minX, Math.floor(maxX)));
        const candidateY = randInt(minY, Math.max(minY, Math.floor(maxY)));
        const candidateRect = {
          left: candidateX - halfW,
          top: candidateY - halfH,
          right: candidateX + halfW,
          bottom: candidateY + halfH
        };
        let overlapAny = false;
        for (const f of forbidden) {
          if (!(candidateRect.right < f.left || candidateRect.left > f.right || candidateRect.bottom < f.top || candidateRect.top > f.bottom)) {
            overlapAny = true;
            break;
          }
        }
        if (!overlapAny) {
          chosenX = candidateX;
          chosenY = candidateY;
          break;
        }
        attempts++;
      }

      // If not found, choose the closest safe fallback: try a few anchor positions (corners / below center)
      if (chosenX === undefined) {
        const anchors = [
          { x: minX + 14, y: maxY - 14 },
          { x: maxX - 14, y: maxY - 14 },
          { x: Math.floor(rect.width / 2), y: maxY - 24 },
          { x: Math.floor(rect.width / 2), y: minY + 24 }
        ];
        for (const a of anchors) {
          const candidateRect = { left: a.x - halfW, top: a.y - halfH, right: a.x + halfW, bottom: a.y + halfH };
          let overlapAny = false;
          for (const f of forbidden) {
            if (!(candidateRect.right < f.left || candidateRect.left > f.right || candidateRect.bottom < f.top || candidateRect.top > f.bottom)) {
              overlapAny = true;
              break;
            }
          }
          if (!overlapAny) { chosenX = a.x; chosenY = a.y; break; }
        }
      }

      // final fallback: keep near current position but nudged
      if (chosenX === undefined) {
        const currentLeft = (btnRect.left - rect.left) + halfW;
        const currentTop = (btnRect.top - rect.top) + halfH;
        chosenX = Math.max(minX, Math.min(maxX, currentLeft + 20));
        chosenY = Math.max(minY, Math.min(maxY, currentTop + 20));
      }

      btn.style.left = chosenX + "px";
      btn.style.top = chosenY + "px";
      btn.style.transform = 'translate(-50%,-50%)';
    }

    function disableControlsTemporary(){
      noBtn.disabled = true;
      yesBtn.disabled = true;
      noBtn.style.cursor = 'default';
      yesBtn.style.cursor = 'default';
      setTimeout(()=>{
        noBtn.disabled = false;
        yesBtn.disabled = false;
        noBtn.style.cursor = '';
        yesBtn.style.cursor = '';
      }, 6000);
    }

    // Hearts effect
    function spawnHearts(count=20){
      const stageRect = stage.getBoundingClientRect();
      for(let i=0;i<count;i++){
        const heart = document.createElement('div');
        heart.className = 'heart';
        const size = randInt(18, 48);
        heart.style.width = size + 'px';
        heart.style.height = size + 'px';
        heart.style.left = randInt(10, Math.max(10, stageRect.width - 30)) + 'px';
        heart.style.top = randInt(stageRect.height - 60, stageRect.height - 10) + 'px';
        heart.style.background = `linear-gradient(180deg, rgb(${randInt(220,255)},${randInt(70,110)},${randInt(90,140)}), rgb(${randInt(200,255)},${randInt(30,70)},${randInt(60,120)}))`;
        heart.style.animationDelay = (Math.random()*800) + 'ms';
        heart.style.opacity = 0.95 - Math.random()*0.2;
        stage.appendChild(heart);
        setTimeout(()=> { heart.remove(); }, 3400 + Math.random()*800);
      }
    }

    // initialize positions (buttons placed lower than center GIF)
    function initButtonPositions(){
      const rect = stage.getBoundingClientRect();
      const centerX = Math.floor(rect.width/2);
      const centerY = Math.floor(rect.height/2);
      const belowOffset = Math.round(rect.height * 0.28);
      noBtn.style.left = (centerX - 80) + 'px';
      noBtn.style.top = (centerY + belowOffset) + 'px';
      yesBtn.style.left = (centerX + 80) + 'px';
      yesBtn.style.top = (centerY + belowOffset) + 'px';
      noBtn.style.transform = 'translate(-50%,-50%)';
      yesBtn.style.transform = 'translate(-50%,-50%) scale(1)';
    }

    window.addEventListener('load', initButtonPositions);
    window.addEventListener('resize', initButtonPositions);

    // Love letter button: position it dynamically to avoid overlapping yes photos and buttons
    function positionAndShowLoveButton(){
      const rect = stage.getBoundingClientRect();

      // Determine yesOverlay region (if shown)
      let overlayRect = null;
      if (yesOverlay.classList.contains('show')) {
        overlayRect = yesOverlay.getBoundingClientRect();
      }

      // Determine buttons region
      const buttonsRect = {
        left: Math.min(yesBtn.getBoundingClientRect().left, noBtn.getBoundingClientRect().left),
        right: Math.max(yesBtn.getBoundingClientRect().right, noBtn.getBoundingClientRect().right),
        top: Math.min(yesBtn.getBoundingClientRect().top, noBtn.getBoundingClientRect().top),
        bottom: Math.max(yesBtn.getBoundingClientRect().bottom, noBtn.getBoundingClientRect().bottom)
      };

      // convert to stage-relative
      const stageLeft = rect.left;
      const stageTop = rect.top;
      const overlayTopRel = overlayRect ? (overlayRect.top - stageTop) : Math.floor(rect.height / 2);
      const overlayBottomRel = overlayRect ? (overlayRect.bottom - stageTop) : Math.floor(rect.height / 2);
      const buttonsTopRel = (buttonsRect.top - stageTop);

      // desired top: normally below overlay bottom but we move it UP more so it's more visible
      const gap = 12;
      let desiredY = overlayBottomRel + gap;

      // Move the button up by an extra offset so it sits higher (user requested)
      const extraUp = 60; // move up 60px from the usual spot
      desiredY = desiredY - extraUp;

      // Ensure it doesn't overlap overlay (if moving up too far)
      const minY = (overlayTopRel + gap) > 0 ? (overlayTopRel + gap) : (rect.height * 0.35);
      if (desiredY < minY) desiredY = minY;

      // Ensure it stays above the buttons area
      const btnHeight = loveLetterBtn.getBoundingClientRect().height || 48;
      const maxAllowed = buttonsTopRel - gap - (btnHeight / 2);
      if (desiredY > maxAllowed) {
        desiredY = Math.max(minY, maxAllowed - 6);
      }

      // clamp within stage
      desiredY = Math.max(btnHeight/2 + 8, Math.min(rect.height - btnHeight/2 - 8, desiredY));

      // set position (stage-relative)
      loveLetterBtn.style.left = (rect.width / 2) + "px";
      loveLetterBtn.style.top = desiredY + "px";
      loveLetterBtn.style.display = 'inline-block';
      loveLetterBtn.setAttribute('aria-hidden', 'false');

      // entrance flourish
      loveLetterBtn.animate([
        { transform: 'translate(-50%,8px) scale(.94)', opacity: 0 },
        { transform: 'translate(-50%,0) scale(1)', opacity: 1 }
      ], { duration: 420, easing: 'cubic-bezier(.2,.9,.2,1)' });
    }

    // Bind love letter open
    loveLetterBtn.addEventListener('click', showLetter);
    loveLetterBtn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showLetter(); } });

  </script>
</body>
</html>

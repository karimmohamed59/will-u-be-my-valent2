<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mai â€” Will you be my Valentine?</title>
  <style>
    :root{
      --bg: #fff0f6;
      --accent: #ff4d6d;
      --muted: #7a536b;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: radial-gradient(circle at 10% 10%, #fff0f6 0%, #fff 30%), linear-gradient(180deg,#ffeef2 0%, #fff0f6 100%);
      color:#3b1f2b;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      position:relative;
      width:min(920px, 95vw);
      height:min(680px, 85vh);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,240,246,0.9));
      border-radius:18px;
      box-shadow: 0 12px 40px rgba(120,40,70,0.12);
      padding:30px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.6);
    }

    h1{
      margin:0;
      font-size:clamp(24px, 3vw, 40px);
      letter-spacing:0.4px;
      color:#5a2336;
      text-align:center;
    }
    p.lead{
      text-align:center;
      margin:12px 0 28px;
      color:var(--muted);
      font-size:clamp(14px, 1.6vw, 18px);
    }

    .stage {
      position:relative;
      width:100%;
      height:60%;
      border-radius:12px;
      background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.65), transparent 10%),
                  linear-gradient(180deg, rgba(255,240,246,0.6), rgba(255, 245, 248, 0.2));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      user-select:none;
    }

    .btn {
      appearance:none;
      border:0;
      padding:14px 22px;
      font-size:18px;
      border-radius:999px;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(120,40,70,0.12);
      transition: left 700ms cubic-bezier(.2,.9,.2,1), top 700ms cubic-bezier(.2,.9,.2,1), transform 350ms;
      position:absolute;
      transform: translate(-50%,-50%);
    }

    .btn:active { transform: translate(-50%,-50%) translateY(2px); }

    .yes {
      background: linear-gradient(90deg,#ff6b81,#ff3b5c);
      color:white;
    }
    .no {
      background: white;
      color:var(--accent);
      border:2px solid rgba(255,77,109,0.12);
    }

    /* initial positions (buttons slightly lower to avoid center GIF) */
    #yesBtn { left:calc(50% + 80px); top:64%; }
    #noBtn  { left:calc(50% - 80px); top:64%; }

    /* centered GIF (higher on screen so it doesn't overlap buttons) */
    .center-gif{
      position:absolute;
      left:50%;
      top:34%;               /* moved higher so buttons don't overlap */
      transform:translate(-50%,-50%);
      width:240px;
      height:240px;
      object-fit:cover;
      border-radius:12px;
      box-shadow:0 18px 50px rgba(120,40,70,0.12);
      cursor:pointer;
      z-index:20;
      pointer-events: auto;
      background: transparent; /* no border, seamless */
    }

    /* photo gallery for no-clicks (bottom-left) */
    .no-gallery {
      position:absolute;
      left:12px;
      bottom:12px;
      display:flex;
      gap:8px;
      align-items:end;
      max-width:40%;
      max-height:40%;
      overflow:hidden;
      z-index:5;
    }
    .no-gallery img {
      width:84px;
      height:64px;
      object-fit:cover;
      border-radius:10px;
      box-shadow: 0 6px 14px rgba(80,30,60,0.12);
      opacity:0;
      transform: translateY(12px) scale(.98);
      transition: opacity 450ms, transform 450ms;
      /* removed border so it looks clean */
      cursor: pointer;
      background: transparent;
    }
    .no-gallery img.show {
      opacity:1;
      transform: translateY(0) scale(1);
    }

    /* overlay for yes result (shows 3 photos) */
    .yes-overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.0), rgba(255,240,246,0.7));
      pointer-events:none;
      opacity:0;
      transition: opacity 350ms;
      z-index:6;
    }
    .yes-overlay.show {
      opacity:1;
      pointer-events:auto;
    }
    .yes-overlay img {
      width:220px;
      height:140px;
      object-fit:cover;
      border-radius:12px;
      box-shadow: 0 12px 40px rgba(120,40,70,0.15);
      transform:scale(.98);
      transition: transform 450ms, box-shadow 300ms;
      cursor: pointer;
      background: transparent; /* no border */
    }
    .yes-overlay.show img { transform:scale(1); }
    .yes-overlay img:hover { transform: scale(1.04); box-shadow: 0 18px 50px rgba(120,40,70,0.2); }

    /* popup (center big photo/GIF) */
    .popup {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(20,10,15,0.45);
      z-index:9999;
      opacity:0;
      pointer-events:none;
      transition: opacity 250ms ease;
      backdrop-filter: blur(6px) saturate(120%);
    }
    .popup.show {
      opacity:1;
      pointer-events:auto;
    }
    .popup-card {
      max-width:min(88vw,980px);
      max-height:86vh;
      border-radius:14px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      transform: scale(.8);
      transition: transform 260ms cubic-bezier(.2,.9,.2,1);
      box-shadow: 0 30px 80px rgba(20,10,20,0.45);
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,250,253,0.95));
    }
    .popup.show .popup-card { transform: scale(1); }
    .popup-card img {
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      background: #000;
    }
    .popup-close {
      position:absolute;
      top:18px;
      right:18px;
      background:rgba(255,255,255,0.85);
      border-radius:999px;
      border:0;
      padding:6px 10px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 8px 18px rgba(120,40,70,0.08);
    }

    /* hearts */
    .heart {
      position:absolute;
      width:26px;
      height:26px;
      background: linear-gradient(180deg,#ff6b81,#ff3b5c);
      transform: rotate(-45deg);
      left:50%;
      top:50%;
      border-radius:4px 4px 0 0;
      pointer-events:none;
      opacity:0.95;
      animation: floatUp 2600ms linear forwards;
      filter: drop-shadow(0 6px 14px rgba(120,40,70,0.12));
    }
    .heart::before, .heart::after {
      content:"";
      position:absolute;
      width:26px;
      height:26px;
      background: linear-gradient(180deg,#ff6b81,#ff3b5c);
      border-radius:50%;
      top:-13px;
      left:0;
    }
    .heart::after { left:13px; top:0; }

    @keyframes floatUp {
      0% { transform: translateY(0) scale(.8) rotate(-45deg); opacity:1; }
      30% { transform: translateY(-60px) scale(1.05) rotate(-35deg); }
      70% { transform: translateY(-180px) scale(.95) rotate(-15deg); opacity:0.85; }
      100% { transform: translateY(-320px) scale(.6) rotate(-5deg); opacity:0; }
    }

    /* small footer */
    .footer {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin-top:12px;
      color:var(--muted);
      font-size:13px;
    }

    /* responsive */
    @media (max-width:600px){
      .center-gif{ width:160px; height:160px; top:28%; }
      .yes-overlay img { width:120px; height:88px; }
      .no-gallery img { width:64px; height:50px; }
      #yesBtn, #noBtn { padding:10px 14px; font-size:16px; top:72%; }
    }
  </style>
</head>
<body>
  <div class="card" role="main" aria-label="Valentine card for Mai">
    <h1>Mai â€” will you be my Valentine?</h1>
    <p class="lead">Click your answer. I promise it'll be fun either way ðŸ’Œ</p>

    <div class="stage" id="stage">
      <div class="controls" aria-hidden="false">
        <button id="noBtn" class="btn no" aria-label="No button">No</button>
        <button id="yesBtn" class="btn yes" aria-label="Yes button">Yes</button>
      </div>

      <!-- Center GIF (replace assets/center.gif with your file or a URL) -->
      <img id="centerGif" class="center-gif" src="assets/center.gif" alt="Surprise GIF â€” click to open" role="button" tabindex="0" aria-label="Open GIF" />

      <div class="no-gallery" id="noGallery" aria-hidden="true"></div>

      <div class="yes-overlay" id="yesOverlay" aria-hidden="true">
        <img id="yesImg1" alt="surprise photo 1" />
        <img id="yesImg2" alt="surprise photo 2" />
        <img id="yesImg3" alt="surprise photo 3" />
      </div>
    </div>

    <div class="footer">Tip: if music doesn't play automatically, try clicking the page again â€” browsers require interaction for audio.</div>
  </div>

  <!-- Popup element (hidden until used) -->
  <div id="popup" class="popup" aria-hidden="true">
    <div class="popup-card" role="dialog" aria-modal="true" aria-label="Photo/GIF popup">
      <img id="popupImg" alt="Large view" />
    </div>
    <button id="popupClose" class="popup-close" aria-label="Close">âœ•</button>
  </div>

  <script>
    // Elements
    const stage = document.getElementById('stage');
    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const noGallery = document.getElementById('noGallery');
    const yesOverlay = document.getElementById('yesOverlay');
    const yesImg1 = document.getElementById('yesImg1');
    const yesImg2 = document.getElementById('yesImg2');
    const yesImg3 = document.getElementById('yesImg3');

    const centerGif = document.getElementById('centerGif');

    const popup = document.getElementById('popup');
    const popupImg = document.getElementById('popupImg');
    const popupClose = document.getElementById('popupClose');

    // ====== Replace with your files (local assets/ or full URLs) ======
    const noImages = [
      "assets/no1.jpg",
      "assets/no2.jpg",
      "assets/no3.jpg",
      "assets/no4.jpg"
    ];
    const yesImages = [
      "assets/yes1.jpg",
      "assets/yes2.jpg",
      "assets/yes3.jpg"
    ];
    const musicUrl = "assets/music.mp3";
    // center GIF path is in the img src attribute above (assets/center.gif)
    // ===================================================================

    const pleadingPhrases = [
      "Please, Mai... â¤ï¸",
      "Don't break my heart ðŸ˜¢",
      "Pretty please? ðŸ¥º",
      "Think again, Mai ðŸ’”âž¡ï¸ðŸ’–",
      "I promise I'll be extra nice ðŸ˜‡",
      "Please say yes, Mai ðŸŒ¹",
      "Not yet? I can try harder ðŸ˜‰",
      "Come on, Mai â€” my heart! ðŸ’“",
      "I brought flowers... virtually ðŸŒ·",
      "I'll do anything! (within reason) ðŸ˜…"
    ];

    let noClicks = 0;
    let yesScale = 1;

    function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }

    // Show popup with a large image/GIF.
    function showPopup(src, autoCloseMs = 0) {
      if (!src) return;
      popupImg.src = src + (src.includes('?') ? '&' : '?') + 'rand=' + Date.now();
      popup.classList.add('show');
      popup.setAttribute('aria-hidden', 'false');

      if (autoCloseMs && autoCloseMs > 0) {
        setTimeout(hidePopup, autoCloseMs);
      }
    }

    function hidePopup() {
      popup.classList.remove('show');
      popup.setAttribute('aria-hidden', 'true');
      setTimeout(() => { popupImg.src = ''; }, 300);
    }

    popupClose.addEventListener('click', hidePopup);
    popup.addEventListener('click', (e) => { if (e.target === popup) hidePopup(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') hidePopup(); });

    // Make center GIF open popup on click or keyboard (Enter/Space)
    centerGif.addEventListener('click', () => showPopup(centerGif.src, 0));
    centerGif.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        showPopup(centerGif.src, 0);
      }
    });

    // When No is clicked
    noBtn.addEventListener('click', (e) => {
      noClicks++;

      // 1) Change text to a random pleading phrase
      const phrase = pleadingPhrases[(noClicks - 1) % pleadingPhrases.length];
      noBtn.textContent = phrase;

      // 2) Move no button to a fun random place inside the stage (click-triggered), avoiding center GIF
      moveButtonRandomlyAvoidingCenter(noBtn);

      // 3) Make yes button bigger
      yesScale += 0.08;
      yesBtn.style.transform = `translate(-50%,-50%) scale(${yesScale})`;

      // 4) Show a photo (append to noGallery) and pop it up to center briefly
      addNoGalleryPhoto(true);

      // small playful wiggle on yes button to draw attention
      yesBtn.animate([
        { transform: `translate(-50%,-50%) scale(${yesScale}) rotate(0deg)` },
        { transform: `translate(-50%,-50%) scale(${yesScale + 0.04}) rotate(-6deg)` },
        { transform: `translate(-50%,-50%) scale(${yesScale}) rotate(6deg)` },
        { transform: `translate(-50%,-50%) scale(${yesScale}) rotate(0deg)` }
      ], {
        duration: 700,
        easing: 'ease-out'
      });
    });

    // Move button randomly but avoid overlapping the centered GIF area.
    function moveButtonRandomlyAvoidingCenter(btn){
      const rect = stage.getBoundingClientRect();
      const btnRect = btn.getBoundingClientRect();
      const centerRect = centerGif.getBoundingClientRect();

      const padding = 12; // keep away from stage edges
      const halfW = btnRect.width / 2;
      const halfH = btnRect.height / 2;
      const minX = halfW + padding;
      const maxX = rect.width - halfW - padding;
      const minY = halfH + padding;
      const maxY = rect.height - halfH - padding;

      // center GIF area relative to stage
      const gifRel = {
        left: Math.max(0, centerRect.left - rect.left),
        top: Math.max(0, centerRect.top - rect.top),
        right: Math.min(rect.width, centerRect.right - rect.left),
        bottom: Math.min(rect.height, centerRect.bottom - rect.top)
      };

      const avoidPadding = 14; // extra space around GIF to avoid feeling cramped
      const gifArea = {
        x1: gifRel.left - avoidPadding,
        y1: gifRel.top - avoidPadding,
        x2: gifRel.right + avoidPadding,
        y2: gifRel.bottom + avoidPadding
      };

      // Try a few times to find a random spot that doesn't overlap the GIF area
      let attempts = 0;
      let chosenX, chosenY;
      while (attempts < 18) {
        const candidateX = randInt(minX, Math.max(minX, Math.floor(maxX)));
        const candidateY = randInt(minY, Math.max(minY, Math.floor(maxY)));
        const candidateRect = {
          left: candidateX - halfW,
          top: candidateY - halfH,
          right: candidateX + halfW,
          bottom: candidateY + halfH
        };
        // check overlap
        const overlap = !(candidateRect.right < gifArea.x1 || candidateRect.left > gifArea.x2 || candidateRect.bottom < gifArea.y1 || candidateRect.top > gifArea.y2);
        if (!overlap) {
          chosenX = candidateX;
          chosenY = candidateY;
          break;
        }
        attempts++;
      }

      // If no safe spot found after attempts, pick a spot below the GIF (if possible)
      if (chosenX === undefined) {
        // try below GIF
        const tryY = Math.min(maxY, Math.max(minY, Math.round(gifArea.y2 + halfH + 10)));
        const tryX = randInt(minX, Math.max(minX, Math.floor(maxX)));
        chosenX = tryX;
        chosenY = tryY;
      }

      btn.style.left = chosenX + "px";
      btn.style.top = chosenY + "px";
      btn.style.transform = 'translate(-50%,-50%)';
    }

    // Add a thumbnail to the no-gallery. If popupNow=true show it centered briefly.
    function addNoGalleryPhoto(popupNow = false){
      const idx = (noClicks - 1) % noImages.length;
      const srcBase = noImages[idx];
      const src = srcBase + (srcBase.includes('?') ? '&' : '?') + "rand=" + Date.now();
      const img = document.createElement('img');
      img.src = src;
      img.alt = "cute photo";
      img.addEventListener('click', () => showPopup(src, 0)); // click to open until manually closed
      noGallery.appendChild(img);

      img.onload = () => { setTimeout(()=> img.classList.add('show'), 40); };
      setTimeout(()=> img.classList.add('show'), 200);

      while (noGallery.children.length > 6) {
        noGallery.removeChild(noGallery.firstChild);
      }

      // pop it to the center briefly for Mai
      if (popupNow) {
        setTimeout(() => showPopup(src, 1400), 220);
      }
    }

    // When Yes clicked
    yesBtn.addEventListener('click', async (e) => {
      yesImg1.src = yesImages[0] + (yesImages[0].includes('?') ? '&' : '?') + "rand=" + Date.now();
      yesImg2.src = yesImages[1] + (yesImages[1].includes('?') ? '&' : '?') + "rand=" + Date.now();
      yesImg3.src = yesImages[2] + (yesImages[2].includes('?') ? '&' : '?') + "rand=" + Date.now();

      yesOverlay.classList.add('show');

      // clicking overlay photos opens the big popup for manual viewing
      yesImg1.onclick = () => showPopup(yesImg1.src, 0);
      yesImg2.onclick = () => showPopup(yesImg2.src, 0);
      yesImg3.onclick = () => showPopup(yesImg3.src, 0);

      // Play music
      try {
        const audio = new Audio(musicUrl);
        audio.volume = 0.85;
        await audio.play();
      } catch (err) {
        console.warn("Audio play failed (browser autoplay policy). Try clicking again.", err);
      }

      // Spawn hearts randomly for a few seconds
      spawnHearts(26);

      // Optionally, lock the buttons briefly
      disableControlsTemporary();
    });

    function disableControlsTemporary(){
      noBtn.disabled = true;
      yesBtn.disabled = true;
      noBtn.style.cursor = 'default';
      yesBtn.style.cursor = 'default';
      setTimeout(()=>{
        noBtn.disabled = false;
        yesBtn.disabled = false;
        noBtn.style.cursor = '';
        yesBtn.style.cursor = '';
      }, 6000);
    }

    function spawnHearts(count=20){
      const stageRect = stage.getBoundingClientRect();
      for(let i=0;i<count;i++){
        const heart = document.createElement('div');
        heart.className = 'heart';
        const size = randInt(18, 40);
        heart.style.width = size + 'px';
        heart.style.height = size + 'px';
        heart.style.left = randInt(10, Math.max(10, stageRect.width - 30)) + 'px';
        heart.style.top = randInt(stageRect.height - 60, stageRect.height - 10) + 'px';
        heart.style.background = `linear-gradient(180deg, rgb(${randInt(220,255)},${randInt(70,110)},${randInt(90,140)}), rgb(${randInt(200,255)},${randInt(30,70)},${randInt(60,120)}))`;
        heart.style.animationDelay = (Math.random()*800) + 'ms';
        heart.style.opacity = 0.95 - Math.random()*0.2;
        stage.appendChild(heart);

        setTimeout(()=> {
          heart.remove();
        }, 3400 + Math.random()*800);
      }
    }

    // initialize positions so CSS translate(-50%,-50%) centers the buttons below the GIF
    function initButtonPositions(){
      const rect = stage.getBoundingClientRect();
      const centerX = Math.floor(rect.width/2);
      const centerY = Math.floor(rect.height/2);
      // place buttons lower than centerGIF area
      const belowOffset = Math.round(rect.height * 0.18);
      noBtn.style.left = (centerX - 80) + 'px';
      noBtn.style.top = (centerY + belowOffset) + 'px';
      yesBtn.style.left = (centerX + 80) + 'px';
      yesBtn.style.top = (centerY + belowOffset) + 'px';
      noBtn.style.transform = 'translate(-50%,-50%)';
      yesBtn.style.transform = 'translate(-50%,-50%) scale(1)';
    }

    window.addEventListener('load', initButtonPositions);
    window.addEventListener('resize', initButtonPositions);
  </script>
</body>
</html>
